import{d as N,e as v,h as y,f as C,u as S,j as e,I as c,B as k,L as b,x as L,D as U,U as T,E as A,F as E,i as I,s as F,t as z,k as B,n as P}from"./index-DE0IHRRq.js";import{r as u}from"./leaflet-vendor-CTVbxAuc.js";import{A as R}from"./AuthFooter-BqfGWd-F.js";import"./mermaid-vendor-B8wVipH8.js";import"./utils-vendor-D86ln76_.js";import"./ThemeSelect-DE7FZob2.js";const H=()=>{const s=N(),m=v(),n=y(!1),[l,d]=u.useState(""),[r,f]=u.useState(""),{initialize:x}=C(),{generalSetting:i,profile:p,initialize:h}=S(),g=t=>{const a=t.target.value;d(a)},w=t=>{const a=t.target.value;f(a)},j=t=>{t.preventDefault(),o()},o=async()=>{if(!(l===""||r==="")&&!n.isLoading){try{n.setLoading();const t=U(T,{username:l,password:r,role:A.USER});await E.createUser({user:t});const a=await I.signIn({credentials:{case:"passwordCredentials",value:{username:l,password:r}}});a.accessToken&&F(a.accessToken,a.accessTokenExpiresAt?z(a.accessTokenExpiresAt):void 0),await x(),await h(),m("/")}catch(t){B(t,P.error,{fallbackMessage:"Sign up failed"})}n.setFinish()}};return e.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-svh mx-auto flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[e.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:i.customProfile?.logoUrl||"/logo.webp",alt:""}),e.jsx("p",{className:"ml-2 text-5xl text-foreground opacity-80",children:i.customProfile?.title||"Memos"})]}),i.disallowUserRegistration?e.jsx("p",{className:"w-full text-2xl mt-2 text-muted-foreground",children:"Sign up is not allowed."}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"w-full text-2xl mt-2 text-muted-foreground",children:s("auth.create-your-account")}),e.jsxs("form",{className:"w-full mt-2",onSubmit:j,children:[e.jsxs("div",{className:"flex flex-col justify-start items-start w-full gap-4",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsx("span",{className:"leading-8 text-muted-foreground",children:s("common.username")}),e.jsx(c,{className:"w-full bg-background h-10",type:"text",readOnly:n.isLoading,placeholder:s("common.username"),value:l,autoComplete:"username",autoCapitalize:"off",spellCheck:!1,onChange:g,required:!0})]}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsx("span",{className:"leading-8 text-muted-foreground",children:s("common.password")}),e.jsx(c,{className:"w-full bg-background h-10",type:"password",readOnly:n.isLoading,placeholder:s("common.password"),value:r,autoComplete:"new-password",autoCapitalize:"off",spellCheck:!1,onChange:w,required:!0})]})]}),e.jsx("div",{className:"flex flex-row justify-end items-center w-full mt-6",children:e.jsxs(k,{type:"submit",className:"w-full h-10",disabled:n.isLoading,onClick:o,children:[s("common.sign-up"),n.isLoading&&e.jsx(b,{className:"w-5 h-auto ml-2 animate-spin opacity-60"})]})})]})]}),p.admin?e.jsxs("p",{className:"w-full mt-4 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:s("auth.sign-in-tip")}),e.jsx(L,{to:"/auth",className:"cursor-pointer ml-2 text-primary hover:underline",viewTransition:!0,children:s("common.sign-in")})]}):e.jsx("p",{className:"w-full mt-4 text-sm font-medium text-muted-foreground",children:s("auth.host-tip")})]}),e.jsx(R,{})]})};export{H as default};
