import{r as I,d as E,e as R,H,J as W,K as _,N as y,k as z,j as e,X as F,T as w,O as n,c as m,Q as O,t as g,W as $,F as k,Y as C,D as L,Z as V,_ as B,$ as P,w as Q,a0 as J,a1 as K,a2 as X,a3 as Y}from"./index-B7c9fGsa.js";import{r as d}from"./leaflet-vendor-CTVbxAuc.js";import{M}from"./message-circle-CG3zGOx3.js";import{s as Z}from"./utils-vendor-D86ln76_.js";import"./mermaid-vendor-eOrljkkv.js";const q=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],G=I("inbox",q),ee=(t,r)=>{d.useEffect(()=>{t()},r)};function te({notification:t}){const r=E(),a=R(),[o,h]=d.useState(void 0),[i,u]=d.useState(void 0),[l,f]=d.useState(void 0),[s,T]=d.useState(!1),[v,S]=d.useState(!1),{data:p}=H(l||"",{enabled:!!l});ee(async()=>{if(t.activityId)try{const c=await W.getActivity({name:`${_}${t.activityId}`});if(c.payload?.payload?.case==="memoComment"){const j=c.payload.payload.value,U=await y.getMemo({name:j.relatedMemo});h(U);const D=await y.getMemo({name:j.memo});u(D),f(t.sender),T(!0)}}catch(c){z(c,()=>{},{context:"Failed to fetch activity",onError:()=>S(!0)});return}},[t.activityId]);const A=async()=>{o&&(a(`/${o.name}`),t.status===n.UNREAD&&b(!0))},b=async(c=!1)=>{await k.updateUserNotification({notification:{name:t.name,status:n.ARCHIVED},updateMask:L(V,{paths:["status"]})}),c||C.success(r("message.archived-successfully"))},N=async()=>{await k.deleteUserNotification({name:t.name}),C.success(r("message.deleted-successfully"))};if(!s&&!v)return e.jsx("div",{className:"w-full px-5 py-4 border-b border-border/60 last:border-b-0 bg-muted/10 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/50 shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"h-4 bg-muted/50 rounded-md w-2/5"}),e.jsx("div",{className:"h-3 bg-muted/40 rounded-md w-3/4"}),e.jsx("div",{className:"h-20 bg-muted/30 rounded-xl"})]})]})});if(v)return e.jsx("div",{className:"w-full px-5 py-4 border-b border-border/60 last:border-b-0 bg-destructive/[0.04] group",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-destructive/15 flex items-center justify-center shrink-0 ring-1 ring-destructive/20",children:e.jsx(F,{className:"w-5 h-5 text-destructive",strokeWidth:2})}),e.jsx("span",{className:"text-sm text-destructive/80 font-medium",children:r("inbox.failed-to-load")})]}),e.jsx("button",{onClick:N,className:"p-1.5 hover:bg-destructive/15 rounded-lg transition-all duration-150 opacity-0 group-hover:opacity-100",title:r("common.delete"),children:e.jsx(w,{className:"w-4 h-4 text-destructive/70 hover:text-destructive transition-colors",strokeWidth:2})})]})});const x=t.status===n.UNREAD;return e.jsxs("div",{className:m("w-full px-5 py-4 border-b border-border/60 last:border-b-0 transition-all duration-200 group relative",x?"bg-primary/[0.03] hover:bg-primary/[0.05]":"hover:bg-muted/30"),children:[x&&e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary to-primary/60"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative shrink-0",children:[e.jsx(O,{className:"w-10 h-10 ring-1 ring-border/40",avatarUrl:p?.avatarUrl}),e.jsx("div",{className:m("absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2 border-background flex items-center justify-center shadow-md transition-all",x?"bg-primary text-primary-foreground":"bg-muted/80 text-muted-foreground"),children:e.jsx(M,{className:"w-2.5 h-2.5",strokeWidth:2.5})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap min-w-0",children:[e.jsx("span",{className:"font-semibold text-sm text-foreground/95",children:p?.displayName||p?.username}),e.jsx("span",{className:"text-sm text-muted-foreground/80",children:"commented on your memo"}),e.jsxs("span",{className:"text-xs text-muted-foreground/60",children:[t.createTime&&g(t.createTime)?.toLocaleDateString([],{month:"short",day:"numeric"})," ","at"," ",t.createTime&&g(t.createTime)?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("div",{className:"flex items-center gap-1 shrink-0",children:x?e.jsx("button",{onClick:()=>b(),className:"p-1.5 hover:bg-primary/10 rounded-lg transition-all duration-150 opacity-0 group-hover:opacity-100",title:r("common.archive"),children:e.jsx($,{className:"w-4 h-4 text-muted-foreground hover:text-primary transition-colors",strokeWidth:2})}):e.jsx("button",{onClick:N,className:"p-1.5 hover:bg-destructive/10 rounded-lg transition-all duration-150 opacity-0 group-hover:opacity-100",title:r("common.delete"),children:e.jsx(w,{className:"w-4 h-4 text-muted-foreground hover:text-destructive transition-colors",strokeWidth:2})})})]}),o&&e.jsx("div",{className:"pl-3 border-l-2 border-muted-foreground/20 mb-3",children:e.jsxs("p",{className:"text-sm text-foreground/60 line-clamp-1 leading-relaxed",children:[e.jsx("span",{className:"text-xs text-muted-foreground/50 font-medium mr-2 uppercase tracking-wide",children:"Original:"}),o.content||e.jsx("span",{className:"italic text-muted-foreground/40",children:"Empty memo"})]})}),i&&e.jsx("div",{onClick:A,className:"p-2 sm:p-3 rounded-lg bg-gradient-to-br from-primary/[0.06] to-primary/[0.03] hover:from-primary/[0.1] hover:to-primary/[0.06] cursor-pointer border border-primary/30 hover:border-primary/50 transition-all duration-200 group/comment shadow-sm hover:shadow",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-5 h-5 flex items-center justify-center shrink-0",children:e.jsx(M,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-primary/60 font-semibold mb-1 uppercase tracking-wider",children:"Comment"}),e.jsx("p",{className:"text-sm text-foreground/90 line-clamp-2",children:i.content||e.jsx("span",{className:"italic text-muted-foreground/50",children:"Empty comment"})})]})]})})]})]})]})}const de=()=>{const t=E(),r=B("md"),[a,o]=d.useState("all"),{data:h=[]}=P(),i=Z(h,s=>-((s.createTime?g(s.createTime):void 0)?.getTime()||0)),u=i.filter(s=>a==="unread"?s.status===n.UNREAD:a==="archived"?s.status===n.ARCHIVED:!0),l=i.filter(s=>s.status===n.UNREAD).length,f=i.filter(s=>s.status===n.ARCHIVED).length;return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!r&&e.jsx(Q,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start rounded-xl bg-background text-foreground overflow-hidden",children:[e.jsx("div",{className:"w-full px-4 py-4 border-b border-border",children:e.jsx("div",{className:"flex flex-row justify-between items-center",children:e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(J,{className:"w-5 h-auto text-muted-foreground"}),e.jsx("h1",{className:"text-xl font-semibold",children:t("common.inbox")}),l>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs font-medium rounded-full bg-primary text-primary-foreground",children:l})]})})}),e.jsx("div",{className:"w-full px-4 py-2 border-b border-border bg-muted/30",children:e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsxs("button",{onClick:()=>o("all"),className:m("px-3 py-1.5 text-sm font-medium rounded-md transition-colors",a==="all"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[t("common.all")," (",i.length,")"]}),e.jsxs("button",{onClick:()=>o("unread"),className:m("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5",a==="unread"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[e.jsx(G,{className:"w-3.5 h-auto"}),t("inbox.unread")," (",l,")"]}),e.jsxs("button",{onClick:()=>o("archived"),className:m("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5",a==="archived"?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[e.jsx(K,{className:"w-3.5 h-auto"}),t("common.archived")," (",f,")"]})]})}),e.jsx("div",{className:"w-full",children:u.length===0?e.jsxs("div",{className:"w-full py-16 flex flex-col justify-center items-center",children:[e.jsx(X,{}),e.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:t(a==="unread"?"inbox.no-unread":a==="archived"?"inbox.no-archived":"message.no-data")})]}):e.jsx("div",{className:"flex flex-col",children:u.map(s=>s.type===Y.MEMO_COMMENT?e.jsx(te,{notification:s},s.name):null)})})]})})]})};export{de as default};
