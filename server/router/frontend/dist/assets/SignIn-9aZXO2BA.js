import{d as p,m as g,u as w,R as y,j as e,x as j,B as v,y as I,z as N,n as d,A as P,C as S,k as b}from"./index-DE0IHRRq.js";import{r as l}from"./leaflet-vendor-CTVbxAuc.js";import{A as U}from"./AuthFooter-BqfGWd-F.js";import{P as A}from"./PasswordSignInForm-BhDir1Gx.js";import{S as C}from"./separator-C1TU6OOC.js";import{a as k}from"./utils-BZW-9zYf.js";import"./mermaid-vendor-B8wVipH8.js";import"./utils-vendor-D86ln76_.js";import"./ThemeSelect-DE7FZob2.js";const M=()=>{const o=p(),c=g(),[i,m]=l.useState([]),{generalSetting:s}=w();l.useEffect(()=>{c?.name&&(window.location.href=y.ROOT)},[c]),l.useEffect(()=>{(async()=>{const{identityProviders:n}=await I.listIdentityProviders({});m(n)})()},[]);const u=async t=>{if(t.type===N.OAUTH2){const n=k("/auth/callback"),r=t.config?.config?.case==="oauth2Config"?t.config.config.value:void 0;if(!r){d.error("Identity provider configuration is invalid.");return}try{const a=P(t.name),{state:f,codeChallenge:x}=await S(a),h=`${r.authUrl}?client_id=${r.clientId}&redirect_uri=${encodeURIComponent(n)}&state=${f}&response_type=code&scope=${encodeURIComponent(r.scopes.join(" "))}&code_challenge=${x}&code_challenge_method=S256`;window.location.href=h}catch(a){b(a,d.error,{context:"Failed to initiate OAuth flow",fallbackMessage:"Failed to initiate sign-in. Please try again."})}}};return e.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-svh mx-auto flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[e.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:s.customProfile?.logoUrl||"/logo.webp",alt:""}),e.jsx("p",{className:"ml-2 text-5xl text-foreground opacity-80",children:s.customProfile?.title||"Memos"})]}),s.disallowPasswordAuth?i.length===0&&e.jsx("p",{className:"w-full text-2xl mt-2 text-muted-foreground",children:"Password auth is not allowed."}):e.jsx(A,{}),!s.disallowUserRegistration&&!s.disallowPasswordAuth&&e.jsxs("p",{className:"w-full mt-4 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:o("auth.sign-up-tip")}),e.jsx(j,{to:"/auth/signup",className:"cursor-pointer ml-2 text-primary hover:underline",viewTransition:!0,children:o("common.sign-up")})]}),i.length>0&&e.jsxs(e.Fragment,{children:[!s.disallowPasswordAuth&&e.jsxs("div",{className:"relative my-4 w-full",children:[e.jsx(C,{}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"bg-background px-2 text-xs text-muted-foreground",children:o("common.or")})})]}),e.jsx("div",{className:"w-full flex flex-col space-y-2",children:i.map(t=>e.jsx(v,{className:"bg-background w-full",variant:"outline",onClick:()=>u(t),children:o("common.sign-in-with",{provider:t.title})},t.name))})]})]}),e.jsx(U,{})]})};export{M as default};
