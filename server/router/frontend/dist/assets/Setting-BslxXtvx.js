import{r as ae,d as T,u as ne,D as j,ay as ms,j as e,az as $,aA as q,aB as W,aC as Q,aD as us,aE as I,I as N,aF as xe,aG as X,B as C,n as w,aH as ve,aI as hs,aJ as E,k as O,c as P,aK as ze,aL as Be,aM as Ke,aN as He,y as oe,aO as V,a4 as re,a5 as ce,a7 as le,a8 as de,aa as H,aP as gs,aQ as $e,aR as ps,aS as xs,aT as qe,aU as fs,aV as ye,aW as Re,aX as js,aY as Ae,aZ as vs,a_ as ys,a$ as bs,U as Se,h as Me,E as fe,F as D,Z as me,m as z,b0 as ws,b1 as Ns,S as he,b2 as Te,b3 as Pe,b4 as Ee,b5 as De,b6 as K,aq as ue,b7 as be,Y as ie,b8 as Ss,b9 as Cs,X as We,W as ks,ba as Us,bb as Qe,Q as Xe,t as je,T as Ye,ax as Is,bc as As,x as Rs,ar as Je,f as Ms,bd as Ts,be as Ps,bf as Es,bg as Ds,V as Ce,bh as Ls,l as _s,b as Os,z as _,bi as J,bj as G,bk as Z,bl as ee,bm as B,bn as ge,bo as Fs,_ as Vs,bp as Gs,w as zs,bq as Bs,br as Ks,bs as Hs}from"./index-B7c9fGsa.js";import{r as x}from"./leaflet-vendor-CTVbxAuc.js";import{u as te}from"./useDialog-CArrf6wl.js";import{S as pe}from"./separator-DQU3sh7C.js";import{J as F,s as $s,K as qs}from"./utils-vendor-D86ln76_.js";import{c as Ws,a as Qs}from"./utils-BZW-9zYf.js";import{L as Xs,T as Ys}from"./ThemeSelect-Dj0qE4sO.js";import"./mermaid-vendor-eOrljkkv.js";const Js=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Zs=ae("circle-question-mark",Js);const et=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],st=ae("circle",et);const tt=[["path",{d:"M11 10.27 7 3.34",key:"16pf9h"}],["path",{d:"m11 13.73-4 6.93",key:"794ttg"}],["path",{d:"M12 22v-2",key:"1osdcq"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M14 12h8",key:"4f43i9"}],["path",{d:"m17 20.66-1-1.73",key:"eq3orb"}],["path",{d:"m17 3.34-1 1.73",key:"2wel8s"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"m20.66 17-1.73-1",key:"sg0v6f"}],["path",{d:"m20.66 7-1.73 1",key:"1ow05n"}],["path",{d:"m3.34 17 1.73-1",key:"nuk764"}],["path",{d:"m3.34 7 1.73 1",key:"1ulond"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["circle",{cx:"12",cy:"12",r:"8",key:"46899m"}]],at=ae("cog",tt);const nt=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],it=ae("database",nt);const ot=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],rt=ae("key",ot);const ct=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],lt=ae("user",ct);function dt({open:t,onOpenChange:o,onSuccess:i}){const r=T(),{generalSetting:s,updateSetting:c}=ne(),[n,l]=x.useState(j(ms,s.customProfile||{})),[d,u]=x.useState(!1),m=y=>{l(b=>({...b,...y}))},a=y=>{m({title:y.target.value})},h=y=>{m({logoUrl:y.target.value})},p=y=>{m({description:y.target.value})},g=()=>{m({title:"Memos",logoUrl:"/logo.webp",description:""})},k=()=>{o(!1)},v=async()=>{if(n.title===""){w.error("Title cannot be empty.");return}u(!0);try{await c(j(ve,{name:hs(E.GENERAL),value:{case:"generalSetting",value:{...s,customProfile:n}}})),w.success(r("message.update-succeed")),i?.(),o(!1)}catch(y){O(y,w.error,{context:"Update customized profile",fallbackMessage:"Failed to update profile"})}finally{u(!1)}};return e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-2xl",children:[e.jsxs(W,{children:[e.jsx(Q,{children:r("setting.system-section.customize-server.title")}),e.jsx(us,{children:"Customize your instance appearance and settings."})]}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"server-name",children:r("setting.system-section.server-name")}),e.jsx(N,{id:"server-name",type:"text",value:n.title,onChange:a,placeholder:"Enter server name"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"icon-url",children:r("setting.system-section.customize-server.icon-url")}),e.jsx(N,{id:"icon-url",type:"text",value:n.logoUrl,onChange:h,placeholder:"Enter icon URL"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"description",children:r("setting.system-section.customize-server.description")}),e.jsx(xe,{id:"description",rows:3,value:n.description,onChange:p,placeholder:"Enter description"})]})]}),e.jsxs(X,{className:"flex-col sm:flex-row sm:justify-between gap-2",children:[e.jsx(C,{variant:"outline",onClick:g,disabled:d,className:"sm:mr-auto",children:r("common.restore")}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(C,{variant:"ghost",onClick:k,disabled:d,className:"flex-1 sm:flex-initial",children:r("common.cancel")}),e.jsx(C,{onClick:v,disabled:d,className:"flex-1 sm:flex-initial",children:d?"Saving...":r("common.save")})]})]})]})})}const L=({title:t,description:o,children:i,className:r,showSeparator:s=!1})=>e.jsxs(e.Fragment,{children:[s&&e.jsx(pe,{className:"my-2"}),e.jsxs("div",{className:P("flex flex-col gap-3",r),children:[(t||o)&&e.jsxs("div",{className:"flex flex-col gap-1",children:[t&&e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]}),e.jsx("div",{className:"flex flex-col gap-3",children:i})]})]}),U=({label:t,description:o,tooltip:i,children:r,className:s,vertical:c=!1})=>e.jsxs("div",{className:P("w-full flex gap-3",c?"flex-col":"flex-row justify-between items-center",s),children:[e.jsxs("div",{className:P("flex flex-col gap-1",c?"w-full":"flex-1 min-w-0"),children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:P("text-sm",c?"font-medium":""),children:t}),i&&e.jsx(ze,{children:e.jsxs(Be,{children:[e.jsx(Ke,{asChild:!0,children:e.jsx(Zs,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(He,{children:e.jsx("p",{className:"max-w-xs",children:i})})]})})]}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]}),e.jsx("div",{className:P("flex items-center",c?"w-full":"shrink-0"),children:r})]}),Y=({title:t,description:o,children:i,className:r,actions:s})=>e.jsxs("div",{className:P("w-full flex flex-col gap-4 pt-2 pb-4",r),children:[(t||o||s)&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[t&&e.jsx("div",{className:"text-base font-semibold text-foreground mb-1",children:typeof t=="string"?e.jsx("h3",{children:t}):t}),o&&e.jsx("p",{className:"text-sm text-muted-foreground",children:o})]}),s&&e.jsx("div",{className:"flex items-center gap-2",children:s})]}),e.jsx("div",{className:"flex flex-col gap-4",children:i})]}),mt=()=>{const t=T(),o=te(),{generalSetting:i,profile:r,updateSetting:s,fetchSetting:c}=ne(),[n,l]=x.useState(i),[d,u]=x.useState([]);x.useEffect(()=>{l({...n,customProfile:i.customProfile})},[i]);const m=()=>{o.open()},a=g=>{l(j(gs,{...n,...g}))},h=async()=>{try{await s(j(ve,{name:`instance/settings/${E[E.GENERAL]}`,value:{case:"generalSetting",value:n}})),await c(E.GENERAL)}catch(g){await O(g,w.error,{context:"Update general settings"});return}w.success(t("message.update-succeed"))};x.useEffect(()=>{p()},[]);const p=async()=>{const{identityProviders:g}=await oe.listIdentityProviders({});u(g)};return e.jsxs(Y,{children:[e.jsx(L,{title:t("common.basic"),children:e.jsx(U,{label:t("setting.system-section.server-name"),description:n.customProfile?.title||"Memos",children:e.jsx(C,{variant:"outline",onClick:m,children:t("common.edit")})})}),e.jsxs(L,{title:t("setting.system-section.title"),showSeparator:!0,children:[e.jsx(U,{label:t("setting.system-section.additional-style"),vertical:!0,children:e.jsx(xe,{className:"font-mono w-full",rows:3,placeholder:t("setting.system-section.additional-style-placeholder"),value:n.additionalStyle,onChange:g=>a({additionalStyle:g.target.value})})}),e.jsx(U,{label:t("setting.system-section.additional-script"),vertical:!0,children:e.jsx(xe,{className:"font-mono w-full",rows:3,placeholder:t("setting.system-section.additional-script-placeholder"),value:n.additionalScript,onChange:g=>a({additionalScript:g.target.value})})})]}),e.jsxs(L,{children:[e.jsx(U,{label:t("setting.instance-section.disallow-user-registration"),children:e.jsx(V,{disabled:r.demo,checked:n.disallowUserRegistration,onCheckedChange:g=>a({disallowUserRegistration:g})})}),e.jsx(U,{label:t("setting.instance-section.disallow-password-auth"),children:e.jsx(V,{disabled:r.demo||d.length===0&&!n.disallowPasswordAuth,checked:n.disallowPasswordAuth,onCheckedChange:g=>a({disallowPasswordAuth:g})})}),e.jsx(U,{label:t("setting.instance-section.disallow-change-username"),children:e.jsx(V,{checked:n.disallowChangeUsername,onCheckedChange:g=>a({disallowChangeUsername:g})})}),e.jsx(U,{label:t("setting.instance-section.disallow-change-nickname"),children:e.jsx(V,{checked:n.disallowChangeNickname,onCheckedChange:g=>a({disallowChangeNickname:g})})}),e.jsx(U,{label:t("setting.instance-section.week-start-day"),children:e.jsxs(re,{value:n.weekStartDayOffset.toString(),onValueChange:g=>{a({weekStartDayOffset:parseInt(g)||0})},children:[e.jsx(ce,{className:"min-w-fit",children:e.jsx(le,{})}),e.jsxs(de,{children:[e.jsx(H,{value:"-1",children:t("setting.instance-section.saturday")}),e.jsx(H,{value:"0",children:t("setting.instance-section.sunday")}),e.jsx(H,{value:"1",children:t("setting.instance-section.monday")})]})]})})]}),e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(C,{disabled:F(n,i),onClick:h,children:t("common.save")})}),e.jsx(dt,{open:o.isOpen,onOpenChange:o.setOpen,onSuccess:()=>{w.success("Profile updated successfully!")}})]})};var Le="Radio",[ut,Ze]=qe(Le),[ht,gt]=ut(Le),es=x.forwardRef((t,o)=>{const{__scopeRadio:i,name:r,checked:s=!1,required:c,disabled:n,value:l="on",onCheck:d,form:u,...m}=t,[a,h]=x.useState(null),p=Re(o,v=>h(v)),g=x.useRef(!1),k=a?u||!!a.closest("form"):!0;return e.jsxs(ht,{scope:i,checked:s,disabled:n,children:[e.jsx(ye.button,{type:"button",role:"radio","aria-checked":s,"data-state":ns(s),"data-disabled":n?"":void 0,disabled:n,value:l,...m,ref:p,onClick:Ae(t.onClick,v=>{s||d?.(),k&&(g.current=v.isPropagationStopped(),g.current||v.stopPropagation())})}),k&&e.jsx(as,{control:a,bubbles:!g.current,name:r,value:l,checked:s,required:c,disabled:n,form:u,style:{transform:"translateX(-100%)"}})]})});es.displayName=Le;var ss="RadioIndicator",ts=x.forwardRef((t,o)=>{const{__scopeRadio:i,forceMount:r,...s}=t,c=gt(ss,i);return e.jsx(vs,{present:r||c.checked,children:e.jsx(ye.span,{"data-state":ns(c.checked),"data-disabled":c.disabled?"":void 0,...s,ref:o})})});ts.displayName=ss;var pt="RadioBubbleInput",as=x.forwardRef(({__scopeRadio:t,control:o,checked:i,bubbles:r=!0,...s},c)=>{const n=x.useRef(null),l=Re(n,c),d=ys(i),u=bs(o);return x.useEffect(()=>{const m=n.current;if(!m)return;const a=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(a,"checked").set;if(d!==i&&p){const g=new Event("click",{bubbles:r});p.call(m,i),m.dispatchEvent(g)}},[d,i,r]),e.jsx(ye.input,{type:"radio","aria-hidden":!0,defaultChecked:i,...s,tabIndex:-1,ref:l,style:{...s.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});as.displayName=pt;function ns(t){return t?"checked":"unchecked"}var xt=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],we="RadioGroup",[ft]=qe(we,[$e,Ze]),is=$e(),os=Ze(),[jt,vt]=ft(we),rs=x.forwardRef((t,o)=>{const{__scopeRadioGroup:i,name:r,defaultValue:s,value:c,required:n=!1,disabled:l=!1,orientation:d,dir:u,loop:m=!0,onValueChange:a,...h}=t,p=is(i),g=ps(u),[k,v]=xs({prop:c,defaultProp:s??null,onChange:a,caller:we});return e.jsx(jt,{scope:i,name:r,required:n,disabled:l,value:k,onValueChange:v,children:e.jsx(fs,{asChild:!0,...p,orientation:d,dir:g,loop:m,children:e.jsx(ye.div,{role:"radiogroup","aria-required":n,"aria-orientation":d,"data-disabled":l?"":void 0,dir:g,...h,ref:o})})})});rs.displayName=we;var cs="RadioGroupItem",ls=x.forwardRef((t,o)=>{const{__scopeRadioGroup:i,disabled:r,...s}=t,c=vt(cs,i),n=c.disabled||r,l=is(i),d=os(i),u=x.useRef(null),m=Re(o,u),a=c.value===s.value,h=x.useRef(!1);return x.useEffect(()=>{const p=k=>{xt.includes(k.key)&&(h.current=!0)},g=()=>h.current=!1;return document.addEventListener("keydown",p),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",p),document.removeEventListener("keyup",g)}},[]),e.jsx(js,{asChild:!0,...l,focusable:!n,active:a,children:e.jsx(es,{disabled:n,required:c.required,checked:a,...d,...s,name:c.name,ref:m,onCheck:()=>c.onValueChange(s.value),onKeyDown:Ae(p=>{p.key==="Enter"&&p.preventDefault()}),onFocus:Ae(s.onFocus,()=>{h.current&&u.current?.click()})})})});ls.displayName=cs;var yt="RadioGroupIndicator",ds=x.forwardRef((t,o)=>{const{__scopeRadioGroup:i,...r}=t,s=os(i);return e.jsx(ts,{...s,...r,ref:o})});ds.displayName=yt;var bt=rs,wt=ls,Nt=ds;function _e({className:t,...o}){return e.jsx(bt,{"data-slot":"radio-group",className:P("grid gap-3",t),...o})}function se({className:t,...o}){return e.jsx(wt,{"data-slot":"radio-group-item",className:P("border-border text-primary aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] disabled:cursor-not-allowed disabled:opacity-50",t),...o,children:e.jsx(Nt,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(st,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Oe({open:t,onOpenChange:o,user:i,onSuccess:r}){const s=T(),[c,n]=x.useState(j(Se,i?{username:i.username,role:i.role}:{})),l=Me(!1),d=!i;x.useEffect(()=>{n(i?j(Se,{username:i.username,role:i.role}):j(Se,{}))},[i]);const u=a=>{n({...c,...a})},m=async()=>{if(d&&(!c.username||!c.password)){w.error("Username and password cannot be empty");return}try{if(l.setLoading(),d)await D.createUser({user:c}),w.success("Create user successfully");else{const a=[];c.username!==i?.username&&a.push("username"),c.password&&a.push("password"),c.role!==i?.role&&a.push("role"),await D.updateUser({user:c,updateMask:j(me,{paths:a})}),w.success("Update user successfully")}l.setFinish(),r?.(),o(!1)}catch(a){O(a,w.error,{context:c?"Update user":"Create user",onError:()=>l.setError()})}};return e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(Q,{children:`${s(d?"common.create":"common.edit")} ${s("common.user")}`})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"username",children:s("common.username")}),e.jsx(N,{id:"username",type:"text",placeholder:s("common.username"),value:c.username,onChange:a=>u({username:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"password",children:s("common.password")}),e.jsx(N,{id:"password",type:"password",placeholder:s("common.password"),autoComplete:"off",value:c.password,onChange:a=>u({password:a.target.value})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{children:s("common.role")}),e.jsxs(_e,{value:String(c.role),onValueChange:a=>u({role:Number(a)}),className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:String(fe.USER),id:"user"}),e.jsx(I,{htmlFor:"user",children:s("setting.member-section.user")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:String(fe.ADMIN),id:"admin"}),e.jsx(I,{htmlFor:"admin",children:s("setting.member-section.admin")})]})]})]})]}),e.jsxs(X,{children:[e.jsx(C,{variant:"ghost",disabled:l.isLoading,onClick:()=>o(!1),children:s("common.cancel")}),e.jsx(C,{disabled:l.isLoading,onClick:m,children:s("common.confirm")})]})]})})}const Ne=({columns:t,data:o,emptyMessage:i="No data",className:r,getRowKey:s})=>e.jsx("div",{className:P("w-full overflow-x-auto",r),children:e.jsx("div",{className:"inline-block min-w-full align-middle border border-border rounded-lg",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{children:e.jsx("tr",{className:"text-sm font-semibold text-left text-foreground",children:t.map(c=>e.jsx("th",{scope:"col",className:P("px-3 py-2",c.className),children:c.header},c.key))})}),e.jsx("tbody",{className:"divide-y divide-border",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t.length,className:"px-3 py-4 text-center text-sm text-muted-foreground",children:i})}):o.map((c,n)=>{const l=s?s(c,n):n.toString();return e.jsx("tr",{children:t.map(d=>{const u=c[d.key],m=d.render?d.render(u,c):u;return e.jsx("td",{className:P("whitespace-nowrap px-3 py-2 text-sm text-muted-foreground",d.className),children:m},d.key)})},l)})})]})})}),St=()=>{const t=T(),o=z(),{data:i=[],refetch:r}=ws(),s=Ns(),c=te(),n=te(),[l,d]=x.useState(),u=$s(i,"id"),[m,a]=x.useState(void 0),[h,p]=x.useState(void 0),g=S=>S===fe.ADMIN?t("setting.member-section.admin"):t("setting.member-section.user"),k=()=>{d(void 0),c.open()},v=S=>{d(S),n.open()},y=async S=>{a(S)},b=async()=>{if(!m)return;const S=m.username;await D.updateUser({user:{name:m.name,state:he.ARCHIVED},updateMask:j(me,{paths:["state"]})}),a(void 0),ie.success(t("setting.member-section.archive-success",{username:S})),await r()},A=async S=>{const{username:M}=S;await D.updateUser({user:{name:S.name,state:he.NORMAL},updateMask:j(me,{paths:["state"]})}),ie.success(t("setting.member-section.restore-success",{username:M})),await r()},R=async S=>{p(S)},f=async()=>{if(!h)return;const{username:S,name:M}=h;s.mutate(M),p(void 0),ie.success(t("setting.member-section.delete-success",{username:S}))};return e.jsxs(Y,{title:t("setting.member-list"),actions:e.jsxs(C,{onClick:k,children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),t("common.create")]}),children:[e.jsx(Ne,{columns:[{key:"username",header:t("common.username"),render:(S,M)=>e.jsxs("span",{className:"text-foreground",children:[M.username,M.state===he.ARCHIVED&&e.jsx("span",{className:"ml-2 italic text-muted-foreground",children:"(Archived)"})]})},{key:"role",header:t("common.role"),render:(S,M)=>g(M.role)},{key:"displayName",header:t("common.nickname"),render:(S,M)=>M.displayName},{key:"email",header:t("common.email"),render:(S,M)=>M.email},{key:"actions",header:"",className:"text-right",render:(S,M)=>o?.name===M.name?e.jsx("span",{className:"text-muted-foreground",children:t("common.yourself")}):e.jsxs(Te,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",children:e.jsx(Ee,{className:"w-4 h-auto"})})}),e.jsxs(De,{align:"end",sideOffset:2,children:[e.jsx(K,{onClick:()=>v(M),children:t("common.update")}),M.state===he.NORMAL?e.jsx(K,{onClick:()=>y(M),children:t("setting.member-section.archive-member")}):e.jsxs(e.Fragment,{children:[e.jsx(K,{onClick:()=>A(M),children:t("common.restore")}),e.jsx(K,{onClick:()=>R(M),className:"text-destructive focus:text-destructive",children:t("setting.member-section.delete-member")})]})]})]})}],data:u,emptyMessage:"No members found",getRowKey:S=>S.name}),e.jsx(Oe,{open:c.isOpen,onOpenChange:c.setOpen,onSuccess:r}),e.jsx(Oe,{open:n.isOpen,onOpenChange:n.setOpen,user:l,onSuccess:r}),e.jsx(ue,{open:!!m,onOpenChange:S=>!S&&a(void 0),title:m?t("setting.member-section.archive-warning",{username:m.username}):"",description:m?t("setting.member-section.archive-warning-description"):"",confirmLabel:t("common.confirm"),cancelLabel:t("common.cancel"),onConfirm:b,confirmVariant:"default"}),e.jsx(ue,{open:!!h,onOpenChange:S=>!S&&p(void 0),title:h?t("setting.member-section.delete-warning",{username:h.username}):"",description:h?t("setting.member-section.delete-warning-description"):"",confirmLabel:t("common.delete"),cancelLabel:t("common.cancel"),onConfirm:f,confirmVariant:"destructive"})]})},Ct=Cs("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-destructive-foreground [a&]:hover:bg-destructive/90",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function kt({className:t,variant:o,asChild:i=!1,...r}){const s=i?Ss:"span";return e.jsx(s,{"data-slot":"badge",className:P(Ct({variant:o}),t),...r})}const Ut=()=>{const t=T(),{memoRelatedSetting:o,updateSetting:i,fetchSetting:r}=ne(),[s,c]=x.useState(o),[n,l]=x.useState(""),d=a=>{const h=j(Us,{...s,...a});c(h)},u=()=>{n&&(d({reactions:qs([...s.reactions,n.trim()])}),l(""))},m=async()=>{if(s.reactions.length===0){w.error("Reactions must not be empty.");return}try{await i(j(ve,{name:`instance/settings/${E[E.MEMO_RELATED]}`,value:{case:"memoRelatedSetting",value:s}})),await r(E.MEMO_RELATED),w.success(t("message.update-succeed"))}catch(a){await O(a,w.error,{context:"Update memo-related settings"})}};return e.jsxs(Y,{children:[e.jsxs(L,{title:t("setting.memo-related-settings.title"),children:[e.jsx(U,{label:t("setting.system-section.disable-public-memos"),children:e.jsx(V,{checked:s.disallowPublicVisibility,onCheckedChange:a=>d({disallowPublicVisibility:a})})}),e.jsx(U,{label:t("setting.system-section.display-with-updated-time"),children:e.jsx(V,{checked:s.displayWithUpdateTime,onCheckedChange:a=>d({displayWithUpdateTime:a})})}),e.jsx(U,{label:t("setting.system-section.enable-double-click-to-edit"),children:e.jsx(V,{checked:s.enableDoubleClickEdit,onCheckedChange:a=>d({enableDoubleClickEdit:a})})}),e.jsx(U,{label:t("setting.memo-related-settings.content-length-limit"),children:e.jsx(N,{className:"w-24",type:"number",defaultValue:s.contentLengthLimit,onBlur:a=>d({contentLengthLimit:Number(a.target.value)})})})]}),e.jsx(L,{title:t("setting.memo-related-settings.reactions"),showSeparator:!0,children:e.jsxs("div",{className:"w-full flex flex-row flex-wrap gap-2",children:[s.reactions.map(a=>e.jsxs(kt,{variant:"outline",className:"flex items-center gap-1.5 h-8 px-3",children:[a,e.jsx("span",{className:"cursor-pointer text-muted-foreground hover:text-destructive",onClick:()=>d({reactions:s.reactions.filter(h=>h!==a)}),children:e.jsx(We,{className:"w-3.5 h-3.5"})})]},a)),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(N,{className:"w-32 h-8",placeholder:t("common.input"),value:n,onChange:a=>l(a.target.value.trim()),onKeyDown:a=>a.key==="Enter"&&u()}),e.jsx(C,{variant:"ghost",size:"sm",onClick:u,className:"h-8 w-8 p-0",children:e.jsx(ks,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(C,{disabled:F(s,o),onClick:m,children:t("common.save")})})]})};function It({open:t,onOpenChange:o,user:i,onSuccess:r}){const s=T(),{mutateAsync:c}=Qe(),[n,l]=x.useState(""),[d,u]=x.useState(""),m=()=>{o(!1)},a=g=>{const k=g.target.value;l(k)},h=g=>{const k=g.target.value;u(k)},p=async()=>{if(i){if(n===""||d===""){w.error(s("message.fill-all"));return}if(n!==d){w.error(s("message.new-password-not-match")),u("");return}try{await c({user:{name:i.name,password:n},updateMask:["password"]}),w(s("message.password-changed")),r?.(),o(!1)}catch(g){await O(g,w.error,{context:"Change member password"})}}};return i?e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-md",children:[e.jsx(W,{children:e.jsxs(Q,{children:[s("setting.account-section.change-password")," (",i.displayName,")"]})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"newPassword",children:s("auth.new-password")}),e.jsx(N,{id:"newPassword",type:"password",placeholder:s("auth.new-password"),value:n,onChange:a})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"newPasswordAgain",children:s("auth.repeat-new-password")}),e.jsx(N,{id:"newPasswordAgain",type:"password",placeholder:s("auth.repeat-new-password"),value:d,onChange:h})]})]}),e.jsxs(X,{children:[e.jsx(C,{variant:"ghost",onClick:m,children:s("common.cancel")}),e.jsx(C,{onClick:p,children:s("common.save")})]})]})}):null}function At({open:t,onOpenChange:o,onSuccess:i}){const r=T(),s=z(),{generalSetting:c}=ne(),{mutateAsync:n}=Qe(),[l,d]=x.useState({avatarUrl:s?.avatarUrl??"",username:s?.username??"",displayName:s?.displayName??"",email:s?.email??"",description:s?.description??""}),u=()=>{o(!1)},m=y=>{d(b=>({...b,...y}))},a=async y=>{const b=y.target.files;if(b&&b.length>0){const A=b[0];if(A.size>2*1024*1024){w.error("Max file size is 2MB");return}try{const R=await Ws(A);m({avatarUrl:R})}catch(R){console.error(R),w.error("Failed to convert image to base64")}}},h=y=>{m({displayName:y.target.value})},p=y=>{m({username:y.target.value})},g=y=>{d(b=>({...b,email:y.target.value}))},k=y=>{d(b=>({...b,description:y.target.value}))},v=async()=>{if(l.username===""){w.error(r("message.fill-all"));return}try{const y=[];F(s?.username,l.username)||y.push("username"),F(s?.displayName,l.displayName)||y.push("display_name"),F(s?.email,l.email)||y.push("email"),F(s?.avatarUrl,l.avatarUrl)||y.push("avatar_url"),F(s?.description,l.description)||y.push("description"),await n({user:{name:s?.name,username:l.username,displayName:l.displayName,email:l.email,avatarUrl:l.avatarUrl,description:l.description},updateMask:y}),w.success(r("message.update-succeed")),i?.(),o(!1)}catch(y){await O(y,w.error,{context:"Update account"})}};return e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(Q,{children:r("setting.account-section.update-information")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(I,{children:r("common.avatar")}),e.jsxs("label",{className:"relative cursor-pointer hover:opacity-80",children:[e.jsx(Xe,{className:"w-10 h-10",avatarUrl:l.avatarUrl}),e.jsx("input",{type:"file",accept:"image/*",className:"absolute invisible w-full h-full inset-0",onChange:a})]}),l.avatarUrl&&e.jsx(We,{className:"w-4 h-auto cursor-pointer opacity-60 hover:opacity-80",onClick:()=>m({avatarUrl:""})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"username",children:[r("common.username"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",r("setting.account-section.username-note"),")"]})]}),e.jsx(N,{id:"username",value:l.username,onChange:p,disabled:c.disallowChangeUsername})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"displayName",children:[r("common.nickname"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",r("setting.account-section.nickname-note"),")"]})]}),e.jsx(N,{id:"displayName",value:l.displayName,onChange:h,disabled:c.disallowChangeNickname})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"email",children:[r("common.email"),e.jsxs("span",{className:"text-sm text-muted-foreground ml-1",children:["(",r("setting.account-section.email-note"),")"]})]}),e.jsx(N,{id:"email",type:"email",value:l.email,onChange:g})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"description",children:r("common.description")}),e.jsx(xe,{id:"description",rows:2,value:l.description,onChange:k})]})]}),e.jsxs(X,{children:[e.jsx(C,{variant:"ghost",onClick:u,children:r("common.cancel")}),e.jsx(C,{onClick:v,children:r("common.save")})]})]})})}function Rt({open:t,onOpenChange:o,onSuccess:i}){const r=T(),s=z(),[c,n]=x.useState({description:"",expiration:30}),l=Me(!1),d=[{label:r("setting.access-token-section.create-dialog.duration-1m"),value:30},{label:"90 Days",value:90},{label:r("setting.access-token-section.create-dialog.duration-never"),value:0}],u=p=>{n({...c,...p})},m=p=>{u({description:p.target.value})},a=p=>{u({expiration:Number(p)})},h=async()=>{if(!c.description){w.error(r("message.description-is-required"));return}try{l.setLoading();const p=await D.createPersonalAccessToken({parent:s?.name,description:c.description,expiresInDays:c.expiration});l.setFinish(),i(p),o(!1)}catch(p){O(p,w.error,{context:"Create access token",onError:()=>l.setError()})}};return e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(Q,{children:r("setting.access-token-section.create-dialog.create-access-token")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"description",children:[r("setting.access-token-section.create-dialog.description")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{id:"description",type:"text",placeholder:r("setting.access-token-section.create-dialog.some-description"),value:c.description,onChange:m})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{children:[r("setting.access-token-section.create-dialog.expiration")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(_e,{value:c.expiration.toString(),onValueChange:a,className:"flex flex-row gap-4",children:d.map(p=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:p.value.toString(),id:`expiration-${p.value}`}),e.jsx(I,{htmlFor:`expiration-${p.value}`,children:p.label})]},p.value))})]})]}),e.jsxs(X,{children:[e.jsx(C,{variant:"ghost",disabled:l.isLoading,onClick:()=>o(!1),children:r("common.cancel")}),e.jsx(C,{disabled:l.isLoading,onClick:h,children:r("common.create")})]})]})})}const Fe=async t=>{const{personalAccessTokens:o}=await D.listPersonalAccessTokens({parent:t});return o.sort((i,r)=>((r.createdAt?je(r.createdAt):void 0)?.getTime()??0)-((i.createdAt?je(i.createdAt):void 0)?.getTime()??0))},Mt=()=>{const t=T(),o=z(),[i,r]=x.useState([]),s=te(),[c,n]=x.useState(void 0);x.useEffect(()=>{Fe(o?.name??"").then(a=>{r(a)})},[]);const l=async a=>{const h=await Fe(o?.name??"");r(h),a.token&&(Is(a.token),w.success(t("setting.access-token-section.access-token-copied-to-clipboard"))),w.success(t("setting.access-token-section.create-dialog.access-token-created",{description:a.personalAccessToken?.description??""}))},d=()=>{s.open()},u=async a=>{n(a)},m=async()=>{if(!c)return;const{name:a,description:h}=c;await D.deletePersonalAccessToken({name:a}),r(p=>p.filter(g=>g.name!==a)),n(void 0),w.success(t("setting.access-token-section.access-token-deleted",{description:h}))};return e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("setting.access-token-section.title")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("setting.access-token-section.description")})]}),e.jsxs(C,{onClick:d,size:"sm",children:[e.jsx(be,{className:"w-4 h-4 mr-1.5"}),t("common.create")]})]}),e.jsx(Ne,{columns:[{key:"description",header:t("common.description"),render:(a,h)=>e.jsx("span",{className:"text-foreground",children:h.description})},{key:"createdAt",header:t("setting.access-token-section.create-dialog.created-at"),render:(a,h)=>(h.createdAt?je(h.createdAt):void 0)?.toLocaleString()},{key:"expiresAt",header:t("setting.access-token-section.create-dialog.expires-at"),render:(a,h)=>(h.expiresAt?je(h.expiresAt):void 0)?.toLocaleString()??t("setting.access-token-section.create-dialog.duration-never")},{key:"actions",header:"",className:"text-right",render:(a,h)=>e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>u(h),children:e.jsx(Ye,{className:"text-destructive w-4 h-auto"})})}],data:i,emptyMessage:"No access tokens found",getRowKey:a=>a.name}),e.jsx(Rt,{open:s.isOpen,onOpenChange:s.setOpen,onSuccess:l}),e.jsx(ue,{open:!!c,onOpenChange:a=>!a&&n(void 0),title:c?t("setting.access-token-section.access-token-deletion",{description:c.description}):"",description:t("setting.access-token-section.access-token-deletion-description"),confirmLabel:t("common.delete"),cancelLabel:t("common.cancel"),onConfirm:m,confirmVariant:"destructive"})]})},Tt=()=>{const t=T(),o=z(),i=te(),r=te(),s=()=>{i.open()},c=()=>{r.open()};return e.jsxs(Y,{children:[e.jsx(L,{title:t("setting.account-section.title"),children:e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-3",children:[e.jsx(Xe,{className:"shrink-0 w-12 h-12",avatarUrl:o?.avatarUrl}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center items-start gap-1",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("span",{className:"text-lg font-semibold",children:o?.displayName}),e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["@",o?.username]})]}),o?.description&&e.jsx("p",{className:"w-full text-sm text-muted-foreground truncate",children:o?.description})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:s,children:[e.jsx(As,{className:"w-4 h-4 mr-1.5"}),t("common.edit")]}),e.jsxs(Te,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",children:e.jsx(Ee,{className:"w-4 h-4"})})}),e.jsx(De,{align:"end",children:e.jsx(K,{onClick:c,children:t("setting.account-section.change-password")})})]})]})]})}),e.jsx(L,{showSeparator:!0,children:e.jsx(Mt,{})}),e.jsx(At,{open:i.isOpen,onOpenChange:i.setOpen}),e.jsx(It,{open:r.isOpen,onOpenChange:r.setOpen,user:o})]})};function Pt({open:t,onOpenChange:o,webhookName:i,onSuccess:r}){const s=T(),c=z(),[n,l]=x.useState({displayName:"",url:""}),d=Me(!1),u=i===void 0;x.useEffect(()=>{i&&c&&D.listUserWebhooks({parent:c.name}).then(g=>{const k=g.webhooks.find(v=>v.name===i);k&&l({displayName:k.displayName,url:k.url})})},[i,c]);const m=g=>{l({...n,...g})},a=g=>{m({displayName:g.target.value})},h=g=>{m({url:g.target.value})},p=async()=>{if(!n.displayName||!n.url){w.error(s("message.fill-all-required-fields"));return}if(!c){w.error("User not authenticated");return}try{d.setLoading(),u?await D.createUserWebhook({parent:c.name,webhook:{displayName:n.displayName,url:n.url}}):await D.updateUserWebhook({webhook:{name:i,displayName:n.displayName,url:n.url},updateMask:j(me,{paths:["display_name","url"]})}),r?.(),o(!1),d.setFinish()}catch(g){O(g,w.error,{context:i?"Update webhook":"Create webhook",onError:()=>d.setError()})}};return e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(Q,{children:s(u?"setting.webhook-section.create-dialog.create-webhook":"setting.webhook-section.create-dialog.edit-webhook")})}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"displayName",children:[s("setting.webhook-section.create-dialog.title")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{id:"displayName",type:"text",placeholder:s("setting.webhook-section.create-dialog.an-easy-to-remember-name"),value:n.displayName,onChange:a})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(I,{htmlFor:"url",children:[s("setting.webhook-section.create-dialog.payload-url")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{id:"url",type:"text",placeholder:s("setting.webhook-section.create-dialog.url-example-post-receive"),value:n.url,onChange:h})]})]}),e.jsxs(X,{children:[e.jsx(C,{variant:"ghost",disabled:d.isLoading,onClick:()=>o(!1),children:s("common.cancel")}),e.jsx(C,{disabled:d.isLoading,onClick:p,children:s("common.create")})]})]})})}const Et=()=>{const t=T(),o=z(),[i,r]=x.useState([]),[s,c]=x.useState(!1),[n,l]=x.useState(void 0),d=async()=>{if(!o)return[];const{webhooks:h}=await D.listUserWebhooks({parent:o.name});return h};x.useEffect(()=>{d().then(h=>{r(h)})},[o]);const u=async()=>{const h=await d(),p=h[h.length-1]?.displayName||"";r(h),c(!1),ie.success(t("setting.webhook-section.create-dialog.create-webhook-success",{name:p}))},m=async h=>{l(h)},a=async()=>{n&&(await D.deleteUserWebhook({name:n.name}),r(i.filter(h=>h.name!==n.name)),l(void 0),ie.success(t("setting.webhook-section.delete-dialog.delete-webhook-success",{name:n.displayName})))};return e.jsxs("div",{className:"w-full flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:t("setting.webhook-section.title")}),e.jsxs(C,{onClick:()=>c(!0),size:"sm",children:[e.jsx(be,{className:"w-4 h-4 mr-1.5"}),t("common.create")]})]}),e.jsx(Ne,{columns:[{key:"displayName",header:t("common.name"),render:(h,p)=>e.jsx("span",{className:"text-foreground",children:p.displayName})},{key:"url",header:t("setting.webhook-section.url"),render:(h,p)=>e.jsx("span",{className:"max-w-[300px] inline-block truncate text-foreground",title:p.url,children:p.url})},{key:"actions",header:"",className:"text-right",render:(h,p)=>e.jsx(C,{variant:"ghost",size:"sm",onClick:()=>m(p),children:e.jsx(Ye,{className:"text-destructive w-4 h-auto"})})}],data:i,emptyMessage:t("setting.webhook-section.no-webhooks-found"),getRowKey:h=>h.name}),e.jsx("div",{className:"w-full",children:e.jsxs(Rs,{className:"text-muted-foreground text-sm inline-flex items-center hover:underline hover:text-primary",to:"https://usememos.com/docs/integrations/webhooks",target:"_blank",children:[t("common.learn-more"),e.jsx(Je,{className:"w-4 h-4 ml-1"})]})}),e.jsx(Pt,{open:s,onOpenChange:c,onSuccess:u}),e.jsx(ue,{open:!!n,onOpenChange:h=>!h&&l(void 0),title:t("setting.webhook-section.delete-dialog.delete-webhook-title",{name:n?.displayName||""}),description:t("setting.webhook-section.delete-dialog.delete-webhook-description"),confirmLabel:t("common.delete"),cancelLabel:t("common.cancel"),onConfirm:a,confirmVariant:"destructive"})]})},Dt=()=>{const t=T(),{currentUser:o,userGeneralSetting:i,refetchSettings:r}=Ms(),{mutate:s}=Ts(o?.name),c=async u=>{_s(u),s({generalSetting:{locale:u},updateMask:["locale"]},{onSuccess:()=>{r()}})},n=u=>{s({generalSetting:{memoVisibility:u},updateMask:["memo_visibility"]},{onSuccess:()=>{r()}})},l=async u=>{Os(u),s({generalSetting:{theme:u},updateMask:["theme"]},{onSuccess:()=>{r()}})},d=i||j(Ps,{locale:"en",memoVisibility:"PRIVATE",theme:"system"});return e.jsxs(Y,{children:[e.jsxs(L,{title:t("common.basic"),children:[e.jsx(U,{label:t("common.language"),children:e.jsx(Xs,{value:d.locale,onChange:c})}),e.jsx(U,{label:t("setting.preference-section.theme"),children:e.jsx(Ys,{value:d.theme,onValueChange:l})})]}),e.jsx(L,{title:t("setting.preference"),showSeparator:!0,children:e.jsx(U,{label:t("setting.preference-section.default-memo-visibility"),children:e.jsxs(re,{value:d.memoVisibility||"PRIVATE",onValueChange:n,children:[e.jsx(ce,{className:"min-w-fit",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{visibility:Ds(d.memoVisibility)}),e.jsx(le,{})]})}),e.jsx(de,{children:[Ce.PRIVATE,Ce.PROTECTED,Ce.PUBLIC].map(u=>Ls(u)).map(u=>e.jsx(H,{value:u,className:"whitespace-nowrap",children:t(`memo.visibility.${u.toLowerCase()}`)},u))})]})})}),e.jsx(L,{showSeparator:!0,children:e.jsx(Et,{})})]})},Ve=({text:t,icon:o,isSelected:i,onClick:r})=>e.jsxs("div",{onClick:r,className:`w-auto max-w-full px-3 leading-8 flex flex-row justify-start items-center cursor-pointer rounded-lg select-none hover:opacity-80 ${i?"bg-accent shadow":""}`,children:[e.jsx(o,{className:"w-4 h-auto mr-2 opacity-80 shrink-0"}),e.jsx("span",{className:"truncate",children:t})]}),ke=[j(ee,{name:"",title:"GitHub",type:_.OAUTH2,identifierFilter:"",config:j(Z,{config:{case:"oauth2Config",value:j(G,{clientId:"",clientSecret:"",authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",userInfoUrl:"https://api.github.com/user",scopes:["read:user"],fieldMapping:j(J,{identifier:"login",displayName:"name",email:"email"})})}})}),j(ee,{name:"",title:"GitLab",type:_.OAUTH2,identifierFilter:"",config:j(Z,{config:{case:"oauth2Config",value:j(G,{clientId:"",clientSecret:"",authUrl:"https://gitlab.com/oauth/authorize",tokenUrl:"https://gitlab.com/oauth/token",userInfoUrl:"https://gitlab.com/oauth/userinfo",scopes:["openid"],fieldMapping:j(J,{identifier:"name",displayName:"name",email:"email"})})}})}),j(ee,{name:"",title:"Google",type:_.OAUTH2,identifierFilter:"",config:j(Z,{config:{case:"oauth2Config",value:j(G,{clientId:"",clientSecret:"",authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",scopes:["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile"],fieldMapping:j(J,{identifier:"email",displayName:"name",email:"email"})})}})}),j(ee,{name:"",title:"Custom",type:_.OAUTH2,identifierFilter:"",config:j(Z,{config:{case:"oauth2Config",value:j(G,{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:j(J,{identifier:"",displayName:"",email:""})})}})})];function Lt({open:t,onOpenChange:o,identityProvider:i,onSuccess:r}){const s=T(),c=[...new Set(ke.map(f=>f.type))],[n,l]=x.useState({title:"",identifierFilter:""}),[d,u]=x.useState(_.OAUTH2),[m,a]=x.useState(j(G,{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:j(J,{identifier:"",displayName:"",email:""})})),[h,p]=x.useState(""),[g,k]=x.useState("GitHub"),v=i===void 0;x.useEffect(()=>{t||(l({title:"",identifierFilter:""}),u(_.OAUTH2),a(j(G,{clientId:"",clientSecret:"",authUrl:"",tokenUrl:"",userInfoUrl:"",scopes:[],fieldMapping:j(J,{identifier:"",displayName:"",email:""})})),p(""),k("GitHub"))},[t]),x.useEffect(()=>{if(t&&i&&(l({title:i.title,identifierFilter:i.identifierFilter}),u(i.type),i.type===_.OAUTH2&&i.config?.config?.case==="oauth2Config")){const f=j(G,i.config.config.value||{});a(f),p(f.scopes.join(" "))}},[t,i]),x.useEffect(()=>{if(!v||!t)return;const f=ke.find(S=>S.title===g);if(f&&(l({title:f.title,identifierFilter:f.identifierFilter}),u(f.type),f.type===_.OAUTH2&&f.config?.config?.case==="oauth2Config")){const S=j(G,f.config.config.value||{});a(S),p(S.scopes.join(" "))}},[g,v,t]);const y=()=>{o(!1)},b=()=>!(n.title===""||d===_.OAUTH2&&(m.clientId===""||m.authUrl===""||m.tokenUrl===""||m.userInfoUrl===""||h===""||m.fieldMapping?.identifier===""||v&&m.clientSecret==="")),A=async()=>{try{v?(await oe.createIdentityProvider({identityProvider:j(ee,{...n,type:d,config:j(Z,{config:{case:"oauth2Config",value:{...m,scopes:h.split(" ")}}})})}),w.success(s("setting.sso-section.sso-created",{name:n.title}))):(await oe.updateIdentityProvider({identityProvider:j(ee,{...n,name:i.name,type:d,config:j(Z,{config:{case:"oauth2Config",value:{...m,scopes:h.split(" ")}}})}),updateMask:j(me,{paths:["title","identifier_filter","config"]})}),w.success(s("setting.sso-section.sso-updated",{name:n.title})))}catch(f){await O(f,w.error,{context:v?"Create identity provider":"Update identity provider"})}r?.(),o(!1)},R=f=>{a({...m,...f})};return e.jsx($,{open:t,onOpenChange:o,children:e.jsxs(q,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(W,{children:e.jsx(Q,{children:s(v?"setting.sso-section.create-sso":"setting.sso-section.update-sso")})}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full space-y-4",children:[v&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-1!",children:s("common.type")}),e.jsxs(re,{value:String(d),onValueChange:f=>u(parseInt(f)),children:[e.jsx(ce,{className:"w-full mb-4",children:e.jsx(le,{})}),e.jsx(de,{children:c.map(f=>e.jsx(H,{value:String(f),children:_[f]||f},f))})]}),e.jsx("p",{className:"mb-2 text-sm font-medium",children:s("setting.sso-section.template")}),e.jsxs(re,{value:g,onValueChange:f=>k(f),children:[e.jsx(ce,{className:"mb-1 h-auto w-full",children:e.jsx(le,{})}),e.jsx(de,{children:ke.map(f=>e.jsx(H,{value:f.title,children:f.title},f.title))})]}),e.jsx(pe,{className:"my-2"})]}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("common.name"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("common.name"),value:n.title,onChange:f=>l({...n,title:f.target.value})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:s("setting.sso-section.identifier-filter")}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.identifier-filter"),value:n.identifierFilter,onChange:f=>l({...n,identifierFilter:f.target.value})}),e.jsx(pe,{className:"my-2"}),d===_.OAUTH2&&e.jsxs(e.Fragment,{children:[v&&e.jsxs("p",{className:"border border-border rounded-md p-2 text-sm w-full mb-2 break-all",children:[s("setting.sso-section.redirect-url"),": ",Qs("/auth/callback")]}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.client-id"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.client-id"),value:m.clientId,onChange:f=>R({clientId:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.client-secret"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.client-secret"),value:m.clientSecret,onChange:f=>R({clientSecret:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.authorization-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.authorization-endpoint"),value:m.authUrl,onChange:f=>R({authUrl:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.token-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.token-endpoint"),value:m.tokenUrl,onChange:f=>R({tokenUrl:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.user-endpoint"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.user-endpoint"),value:m.userInfoUrl,onChange:f=>R({userInfoUrl:f.target.value})}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.scopes"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.scopes"),value:h,onChange:f=>p(f.target.value)}),e.jsx(pe,{className:"my-2"}),e.jsxs("p",{className:"mb-1 text-sm font-medium",children:[s("setting.sso-section.identifier"),e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.identifier"),value:m.fieldMapping.identifier,onChange:f=>R({fieldMapping:{...m.fieldMapping,identifier:f.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:s("setting.sso-section.display-name")}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("setting.sso-section.display-name"),value:m.fieldMapping.displayName,onChange:f=>R({fieldMapping:{...m.fieldMapping,displayName:f.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:s("common.email")}),e.jsx(N,{className:"mb-2 w-full",placeholder:s("common.email"),value:m.fieldMapping.email,onChange:f=>R({fieldMapping:{...m.fieldMapping,email:f.target.value}})}),e.jsx("p",{className:"mb-1 text-sm font-medium",children:"Avatar URL"}),e.jsx(N,{className:"mb-2 w-full",placeholder:"Avatar URL",value:m.fieldMapping.avatarUrl,onChange:f=>R({fieldMapping:{...m.fieldMapping,avatarUrl:f.target.value}})})]})]}),e.jsxs(X,{children:[e.jsx(C,{variant:"ghost",onClick:y,children:s("common.cancel")}),e.jsx(C,{onClick:A,disabled:!b(),children:s(v?"common.create":"common.update")})]})]})})}const _t=t=>{const{className:o,url:i,title:r}=t,s=T();return e.jsx(ze,{children:e.jsxs(Be,{children:[e.jsx(Ke,{asChild:!0,children:e.jsx("a",{className:`text-muted-foreground hover:text-primary ${o}`,href:i,target:"_blank",children:e.jsx(Je,{className:"w-4 h-auto"})})}),e.jsx(He,{children:e.jsx("p",{children:r??s("common.learn-more")})})]})})},Ot=()=>{const t=T(),[o,i]=x.useState([]),[r,s]=x.useState(!1),[c,n]=x.useState(),[l,d]=x.useState(void 0);x.useEffect(()=>{u()},[]);const u=async()=>{const{identityProviders:v}=await oe.listIdentityProviders({});i(v)},m=async v=>{d(v)},a=async()=>{if(l){try{await oe.deleteIdentityProvider({name:l.name})}catch(v){O(v,w.error,{context:"Delete identity provider"})}await u(),d(void 0)}},h=()=>{n(void 0),s(!0)},p=v=>{n(v),s(!0)},g=async()=>{await u(),s(!1),n(void 0)},k=v=>{s(v),v||n(void 0)};return e.jsxs(Y,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t("setting.sso-section.sso-list")}),e.jsx(_t,{url:"https://usememos.com/docs/configuration/authentication"})]}),actions:e.jsxs(C,{onClick:h,children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),t("common.create")]}),children:[e.jsx(Ne,{columns:[{key:"title",header:t("common.name"),render:(v,y)=>e.jsxs("span",{className:"text-foreground",children:[y.title,e.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",y.type,")"]})]})},{key:"actions",header:"",className:"text-right",render:(v,y)=>e.jsxs(Te,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(C,{variant:"outline",size:"sm",children:e.jsx(Ee,{className:"w-4 h-auto"})})}),e.jsxs(De,{align:"end",sideOffset:2,children:[e.jsx(K,{onClick:()=>p(y),children:t("common.edit")}),e.jsx(K,{onClick:()=>m(y),className:"text-destructive focus:text-destructive",children:t("common.delete")})]})]})}],data:o,emptyMessage:t("setting.sso-section.no-sso-found"),getRowKey:v=>v.name}),e.jsx(Lt,{open:r,onOpenChange:k,identityProvider:c,onSuccess:g}),e.jsx(ue,{open:!!l,onOpenChange:v=>!v&&d(void 0),title:l?t("setting.sso-section.confirm-delete",{name:l.title}):"",confirmLabel:t("common.delete"),cancelLabel:t("common.cancel"),onConfirm:a,confirmVariant:"destructive"})]})},Ft=()=>{const t=T(),{storageSetting:o,updateSetting:i,fetchSetting:r}=ne(),[s,c]=x.useState(o);x.useEffect(()=>{c(o)},[o]);const n=x.useMemo(()=>{if(s.uploadSizeLimitMb<=0)return!1;if(s.storageType===B.LOCAL){if(s.filepathTemplate.length===0)return!1}else if(s.storageType===B.S3&&(s.s3Config?.accessKeyId.length===0||s.s3Config?.accessKeySecret.length===0||s.s3Config?.endpoint.length===0||s.s3Config?.region.length===0||s.s3Config?.bucket.length===0))return!1;return!F(o,s)},[s,o]),l=async b=>{let A=parseInt(b.target.value);Number.isNaN(A)&&(A=0);const R=j(ge,{...s,uploadSizeLimitMb:BigInt(A)});c(R)},d=async b=>{const A=j(ge,{...s,filepathTemplate:b.target.value});c(A)},u=async b=>{const A=s.s3Config,R={accessKeyId:A?.accessKeyId??"",accessKeySecret:A?.accessKeySecret??"",endpoint:A?.endpoint??"",region:A?.region??"",bucket:A?.bucket??"",usePathStyle:A?.usePathStyle??!1,...b},f=j(ge,{storageType:s.storageType,filepathTemplate:s.filepathTemplate,uploadSizeLimitMb:s.uploadSizeLimitMb,s3Config:j(Fs,R)});c(f)},m=async b=>{u({accessKeyId:b.target.value})},a=async b=>{u({accessKeySecret:b.target.value})},h=async b=>{u({endpoint:b.target.value})},p=async b=>{u({region:b.target.value})},g=async b=>{u({bucket:b.target.value})},k=b=>{u({usePathStyle:b.target.checked})},v=async b=>{const A=j(ge,{...s,storageType:b});c(A)},y=async()=>{try{await i(j(ve,{name:`instance/settings/${E[E.STORAGE]}`,value:{case:"storageSetting",value:s}})),await r(E.STORAGE),w.success("Updated")}catch(b){O(b,w.error,{context:"Update storage settings"})}};return e.jsxs(Y,{children:[e.jsxs(L,{title:t("setting.storage-section.current-storage"),children:[e.jsx("div",{className:"w-full",children:e.jsxs(_e,{value:String(s.storageType),onValueChange:b=>{v(Number(b))},className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:String(B.DATABASE),id:"database"}),e.jsx(I,{htmlFor:"database",children:t("setting.storage-section.type-database")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:String(B.LOCAL),id:"local"}),e.jsx(I,{htmlFor:"local",children:t("setting.storage-section.type-local")})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{value:String(B.S3),id:"s3"}),e.jsx(I,{htmlFor:"s3",children:"S3"})]})]})}),e.jsx(U,{label:t("setting.system-section.max-upload-size"),tooltip:t("setting.system-section.max-upload-size-hint"),children:e.jsx(N,{className:"w-24 font-mono",value:String(s.uploadSizeLimitMb),onChange:l})}),s.storageType!==B.DATABASE&&e.jsx(U,{label:t("setting.storage-section.filepath-template"),children:e.jsx(N,{className:"w-64",value:s.filepathTemplate,placeholder:"assets/{timestamp}_{filename}",onChange:d})})]}),s.storageType===B.S3&&e.jsxs(L,{title:"S3 Configuration",showSeparator:!0,children:[e.jsx(U,{label:"Access key id",children:e.jsx(N,{className:"w-64",value:s.s3Config?.accessKeyId,onChange:m})}),e.jsx(U,{label:"Access key secret",children:e.jsx(N,{className:"w-64",type:"password",value:s.s3Config?.accessKeySecret,onChange:a})}),e.jsx(U,{label:"Endpoint",children:e.jsx(N,{className:"w-64",value:s.s3Config?.endpoint,onChange:h})}),e.jsx(U,{label:"Region",children:e.jsx(N,{className:"w-64",value:s.s3Config?.region,onChange:p})}),e.jsx(U,{label:"Bucket",children:e.jsx(N,{className:"w-64",value:s.s3Config?.bucket,onChange:g})}),e.jsx(U,{label:"Use Path Style",children:e.jsx(V,{checked:s.s3Config?.usePathStyle,onCheckedChange:b=>k({target:{checked:b}})})})]}),e.jsx("div",{className:"w-full flex justify-end",children:e.jsx(C,{disabled:!n,onClick:y,children:t("common.save")})})]})},Ue=["my-account","preference"],Ie=["member","system","memo-related","storage","sso"],Ge={"my-account":lt,preference:at,member:Hs,system:Ks,"memo-related":Bs,storage:it,sso:rt},Wt=()=>{const t=T(),o=Vs("sm"),i=Gs(),r=z(),{profile:s,fetchSetting:c}=ne(),[n,l]=x.useState({selectedSection:"my-account"}),d=r?.role===fe.ADMIN,u=x.useMemo(()=>{let a=[...Ue];return d&&(a=a.concat(Ie)),a},[d]);x.useEffect(()=>{let a=i.hash.slice(1);[...Ue,...Ie].includes(a)||(a="my-account"),l({selectedSection:a})},[i.hash]),x.useEffect(()=>{d&&(async()=>[E.MEMO_RELATED,E.STORAGE].forEach(async a=>{await c(a)}))()},[d,c]);const m=x.useCallback(a=>{window.location.hash=a},[]);return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-start sm:pt-3 md:pt-6 pb-8",children:[!o&&e.jsx(zs,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full border border-border flex flex-row justify-start items-start px-4 py-3 rounded-xl bg-background text-muted-foreground",children:[o&&e.jsxs("div",{className:"flex flex-col justify-start items-start w-40 h-auto shrink-0 py-2",children:[e.jsx("span",{className:"text-sm mt-0.5 pl-3 font-mono select-none text-muted-foreground",children:t("common.basic")}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:Ue.map(a=>e.jsx(Ve,{text:t(`setting.${a}`),icon:Ge[a],isSelected:n.selectedSection===a,onClick:()=>m(a)},a))}),d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm mt-4 pl-3 font-mono select-none text-muted-foreground",children:t("common.admin")}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start mt-1",children:[Ie.map(a=>e.jsx(Ve,{text:t(`setting.${a}`),icon:Ge[a],isSelected:n.selectedSection===a,onClick:()=>m(a)},a)),e.jsxs("span",{className:"px-3 mt-2 opacity-70 text-sm",children:[t("setting.version"),": v",s.version]})]})]}):null]}),e.jsxs("div",{className:"w-full grow sm:pl-4 overflow-x-auto",children:[!o&&e.jsx("div",{className:"w-auto inline-block my-2",children:e.jsxs(re,{value:n.selectedSection,onValueChange:a=>m(a),children:[e.jsx(ce,{className:"w-[180px]",children:e.jsx(le,{placeholder:"Select section"})}),e.jsx(de,{children:u.map(a=>e.jsx(H,{value:a,children:t(`setting.${a}`)},a))})]})}),n.selectedSection==="my-account"?e.jsx(Tt,{}):n.selectedSection==="preference"?e.jsx(Dt,{}):n.selectedSection==="member"?e.jsx(St,{}):n.selectedSection==="system"?e.jsx(mt,{}):n.selectedSection==="memo-related"?e.jsx(Ut,{}):n.selectedSection==="storage"?e.jsx(Ft,{}):n.selectedSection==="sso"?e.jsx(Ot,{}):null]})]})})]})};export{Wt as default};
