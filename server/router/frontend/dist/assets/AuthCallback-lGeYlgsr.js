import{e as M,f as y,q as E,v as T,i as A,s as S,t as w,k as j,j as f}from"./index-DE0IHRRq.js";import{r as g}from"./leaflet-vendor-CTVbxAuc.js";import{a as C}from"./utils-BZW-9zYf.js";import"./mermaid-vendor-B8wVipH8.js";import"./utils-vendor-D86ln76_.js";const N=()=>{const a=M(),{initialize:p}=y(),[t]=E(),[s,r]=g.useState({loading:!0,errorMessage:""});return g.useEffect(()=>{const o=t.get("error"),i=t.get("error_description"),n=t.get("error_uri");if(o){let e=`OAuth error: ${o}`;i&&(e+=`
${decodeURIComponent(i)}`),n&&(e+=`
More info: ${n}`),r({loading:!1,errorMessage:e});return}const c=t.get("code"),l=t.get("state");if(!c||!l){r({loading:!1,errorMessage:"Failed to authorize. Missing authorization code or state parameter."});return}const d=T(l);if(!d){r({loading:!1,errorMessage:"Failed to authorize. Invalid or expired state parameter. This may indicate a CSRF attack attempt."});return}const{identityProviderId:m,returnUrl:h,codeVerifier:v}=d,k=C("/auth/callback");(async()=>{try{const e=await A.signIn({credentials:{case:"ssoCredentials",value:{idpId:m,code:c,redirectUri:k,codeVerifier:v||""}}});e.accessToken&&S(e.accessToken,e.accessTokenExpiresAt?w(e.accessTokenExpiresAt):void 0),r({loading:!1,errorMessage:""}),await p(),a(h||"/")}catch(e){j(e,()=>{},{fallbackMessage:"Failed to authenticate.",onError:u=>{const x=u instanceof Error?u.message:"Failed to authenticate.";r({loading:!1,errorMessage:x})}})}})()},[t,a]),s.loading?null:f.jsx("div",{className:"p-4 py-24 w-full h-full flex justify-center items-center",children:f.jsx("div",{className:"max-w-lg font-mono whitespace-pre-wrap opacity-80",children:s.errorMessage})})};export{N as default};
